<!-- Добавляем запись времени начала выполнения метода -->
        <setProperty propertyName="methodStartTime">
            <simple>${date:now:yyyy-MM-dd HH:mm:ss.SSS}</simple>
        </setProperty>
        <setProperty propertyName="methodStartTimestamp">
            <simple>${date:now:epoch}</simple>
        </setProperty>




<route id="timingLoggerRoute">
    <description>Reusable route for method execution timing</description>
    <from uri="direct:logMethodTiming"/>
    
    <!-- Параметры (должны быть установлены перед вызовом) -->
    <choice>
        <when>
            <simple>${exchangeProperty.methodName} == null</simple>
            <setProperty name="methodName">
                <simple>anonymous_method</simple>
            </setProperty>
        </when>
    </choice>

    <!-- Расчет времени выполнения -->
    <setProperty name="methodEndTime">
        <simple>${date:now:yyyy-MM-dd HH:mm:ss.SSS}</simple>
    </setProperty>
    <setProperty name="executionTimeMs">
        <groovy>
            (System.currentTimeMillis() - exchange.properties.methodStartTimestamp)
        </groovy>
    </setProperty>

    <!-- Логирование -->
    <log message="[TIMING] Method: ${exchangeProperty.methodName} | Start: ${exchangeProperty.methodStartTime} | End: ${exchangeProperty.methodEndTime} | Duration: ${exchangeProperty.executionTimeMs} ms"
         loggingLevel="INFO"
         loggerRef="ru.seventech.esb.timing"/>
</route>
