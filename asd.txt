<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
         http://www.springframework.org/schema/beans 
         http://www.springframework.org/schema/beans/spring-beans.xsd
         http://camel.apache.org/schema/spring 
         https://camel.apache.org/schema/spring/camel-spring-3.20.5.xsd"> <!-- Точная версия XSD -->

    <bean id="trustAllHttpClientConfigurer" class="ru.seventech.esb.technoprom.config.TrustAllHttpClientConfigurer"/>
    <bean id="organizationDataProcessor" class="ru.seventech.esb.technoprom.processor.OrganizationDataProcessor"/>
    
    <!-- Обязательное имя бина для кастомного маскировщика -->
    <bean id="CamelCustomLogMask" class="ru.seventech.esb.technoprom.config.CustomMaskingFormatter"/>

    <camelContext xmlns="http://camel.apache.org/schema/spring" 
                 id="gate_rr_adapter" 
                 useMDCLogging="true" 
                 logMask="CamelCustomLogMask"> <!-- Атрибут logMask, а не logMaskRef -->

        <!-- Обработка исключений -->
        <onException>
            <exception>java.net.SocketException</exception>
            <redeliveryPolicy maximumRedeliveries="3" redeliveryDelay="5000"/>
        </onException>
        <onException>
            <exception>java.net.SocketTimeoutException</exception>
            <redeliveryPolicy maximumRedeliveries="3" redeliveryDelay="5000"/>
        </onException>

        <!-- Конфигурация REST -->
        <restConfiguration 
            contextPath="/private" 
            apiContextPath="api-docs" 
            apiContextListing="true" 
            cors="true"> <!-- CORS активирован через атрибут -->
            
            <!-- Только необходимые apiProperty (без дублирования cors) -->
            <apiProperty key="base.path" value="rest"/>
            <apiProperty key="api.version" value="1.0.0"/>
            <apiProperty key="api.title" value="Адаптер Технопром"/>
            <apiProperty key="api.description" value="Адаптер для доступа к сервисам Технопром"/>
            <apiProperty key="api.contact.name" value="7tech"/>
        </restConfiguration>
    </camelContext>
</beans>
