public static List<FileInfo> createFileInfo(DocumentVersion dv, CreateDocumentRequestDto req) {
    List<FileInfo> fileInfos = new ArrayList<>();
    List<FileEntity> fileList = dv.getFiles();

    for (FileEntity file : fileList) {
        String fullDocName = file.getFilename() + "." + file.getFileExtension();
        CreateDocumentRequestDto.FileWithSignatures matchedRequestFile = req.getFiles().stream()
            .filter(f -> fullDocName.equals(f.getFileName()))
            .findFirst()
            .orElse(null);

        List<Signature> signatures = new ArrayList<>();
        List<ru.domrfbank.evklid.dto.document.CreateDocumentRequestDto.Signature> requestSignatures =
            matchedRequestFile != null ? matchedRequestFile.getSignatures() : List.of();

        for (int j = 0; j < file.getSignatures().size(); j++) {
            String sigFileName = (j < requestSignatures.size())
                ? requestSignatures.get(j).getSigFileName()
                : "signature_" + j; // fallback, если не нашли

            signatures.add(Signature.builder()
                .sigFileId(file.getSignatures().get(j).getSignatureFileId())
                .sigFileName(sigFileName)
                .build());
        }

        fileInfos.add(FileInfo.builder()
            .fileId(file.getContentId())
            .fileName(file.getFilename())
            .signatures(signatures)
            .build());
    }

    return fileInfos;
}
