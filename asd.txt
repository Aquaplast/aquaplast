<route id="logMethodTiming">
    <description>Логирует время выполнения метода</description>
    <from uri="direct:logMethodTiming"/>

    <!-- Название метода по умолчанию -->
    <choice>
        <when>
            <simple>${exchangeProperty.methodName} == null</simple>
            <setProperty propertyName="methodName">
                <constant>anonymous_method</constant>
            </setProperty>
        </when>
    </choice>

    <!-- Конец выполнения -->
    <setProperty propertyName="methodEndTime">
        <simple>${date:now:yyyy-MM-dd HH:mm:ss.SSS}</simple>
    </setProperty>

    <!-- Вычисление продолжительности -->
    <setProperty propertyName="executionTimeMs">
        <groovy>
            def start = exchange.getProperty("methodStartTimestamp") ?: System.currentTimeMillis();
            return System.currentTimeMillis() - start;
        </groovy>
    </setProperty>

    <!-- Лог -->
    <log logName="method.timing"
         loggingLevel="INFO"
         message="[TIMING] Method: ${exchangeProperty.methodName} | Start: ${exchangeProperty.methodStartTime} | End: ${exchangeProperty.methodEndTime} | Duration: ${exchangeProperty.executionTimeMs} ms | Info: ${exchangeProperty.logInfo}"/>
</route>
